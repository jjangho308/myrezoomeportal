var reqparam=[],sortingField="date",sortingOrder="desc";function certckeckboxclick(e){var t=sessionStorage.getItem(e),r=JSON.parse(t);reqparam.push(r.data),console.log("Cert REQ PARAM"),console.log(reqparam)}function certredirect(e){console.log("######## certdirect ###########"),window.location.href="/certs/"+e}function certdelete(e){window.event.stopPropagation(),$.ajax({type:"DELETE",url:"/certs/"+e,headers:{Authorization:client_authorization},error:function(e,t,r){console.error("Delete cert : "+r),console.error(e.responseText)},success:function(e){$("#alarm-div span").text("증명서 삭제가 완료되었습니다."),$("#alarm-div").css("display","block"),setTimeout(function(){$("#alarm-div").hide()},3e3),loadcertlist()},contentType:"application/json"})}function certmore(e){$("#"+e).css("display","block"),window.event.stopPropagation()}function loadcertlist(){$.ajax({type:"GET",url:"/certs/list",headers:{Authorization:client_authorization},error:function(e,t,r){console.error("/certs/list "+r),console.error(e.responseText)},success:function(e){console.log(e);var t=e.result;$(".cert-container").remove(),$("#certlistcount").text(t.length+"건");var o=$("#cert-grid-div");t.sort(function(e,t){if("date"==sortingField){if("asc"==sortingOrder)return Number(new Date(e.date))-Number(new Date(t.date));if("desc"==sortingOrder)return Number(new Date(t.date))-Number(new Date(e.date))}else if("subId"==sortingField){if("asc"==sortingOrder)return e.subId<t.subId?-1:e.subId>t.subId?1:0;if("desc"==sortingOrder)return t.subId>e.subId?-1:e.subId<t.subId?1:0}}),t.forEach(function(e){var t=(new Date-new Date(e.date))/1e3;console.log("====current time - data create time===="),console.log(t);var r='<div class="cert-container" tabindex="1" onclick=certredirect("'+e.certId+'")>';t<300&&(console.log("300 under"),r='<div class="cert-container" tabindex="1" onclick=certredirect("'+e.certId+'") style="border-color:#4c80f1;")>'),r=r+'<p><img style="z-index:999" src="/img/resume-store/trash.svg" alt="" class="more-store-resume" onclick=certdelete("'+e.certId+'")></p>',"RCOGC0014"==e.subId||"RCOGC0012"==e.subId||"RCOGC0010"==e.subId||"RCOGC0008"==e.subId?r+='<img src="img/mycert/icon-certs-gradu.svg" alt="">':"RCOGC0015"==e.subId||"RCOGC0013"==e.subId||"RCOGC0011"==e.subId||"RCOGC0009"==e.subId?r+='<img src="img/mycert/icon-certs-score.svg" alt="">':r+='<img src="img/mycert/color_2.png" alt="">',r=(r=(r+="<p>증명서</p>")+"<p>"+e.title+"</p>")+"<p>발급일시 : "+formatDateYYYYMMDDHHMM(e.date)+"</p>",r+="</div>",o.append(r)})},contentType:"application/json"})}$(document).ready(function(){$(".modal tbody").mCustomScrollbar({theme:"minimal-dark"}),client_token=getCookie("JWT"),client_authorization="Bearer "+client_token,loadcertlist(),$("#header-myresume").css({border:"none","font-weight":"normal"}),$("#header-resume-store").css({border:"none","font-weight":"normal"}),$("#header-mycert").css({"border-bottom":"solid 5px #4c80f1","font-weight":"bold"}),$("#header-mycert").click(function(){window.location="certs"}),$("#header-resume-store").click(function(){window.location="resumes"}),$("#header-myresume").click(function(){window.location="main"}),$(".cert-container").click(function(e){console.log($(e.target)),"more-store-resume"!=$(e.target).prop("class")&&"more-store-resume-p"!=$(e.target).prop("class")&&(window.location="/certviewer")}),console.log("=====Cert page====="),$(".add-cert").click(function(){console.log("증명서 발급 목록 클릭"),$("#add-cert-dialog").modal("show");var l=getTxidList();$(".certtr").remove(),$.ajax({type:"POST",url:"/certs/getmapping",headers:{Authorization:client_authorization},data:"",error:function(e,t,r){console.error("Get mapping error : "+r),console.error(e.responseText)},success:function(e){for(var t in console.log(e),l)try{var r=getData(l[t]),o=r.subid,c="",n="";for(var s in"RCCNF0001"==o||"RCGOC0002"==o||"RCCNF0003"==o||"RCGOC0004"==o||"RCCNF0001"==o||"RCCNF0001"==o?n="자격":"RCLPT0005"==o?n="어학":"RCOGC0008"!=o&&"RCOGC0009"!=o&&"RCOGC0010"!=o&&"RCOGC0011"!=o||(n="학력"),e)e[s].SUB_ID==o&&(c=e[s].SUB_NM);var a=l[t],i='<tr class="certtr">';i+="<td>",i=(i=(i+='<div class="checkbox checkbox-primary">')+"<input id="+a+' type="checkbox" name="certcheck">')+"<label for="+a+"></label>",i+="</div>",i=(i+="</td>")+"<td>"+n+"</td>",null!=r.data.ea_exam_time?i=i+"<td>"+formatDate(r.data.ea_exam_time)+"</td>":null!=r.data.ctestday?i=i+"<td>"+formatDate(r.data.ctestday)+"</td>":i+="<td></td>",i=i+"<td>"+c+"</td>",i+="</tr>",$("#add-cert-dialog-table").append(i)}catch(e){console.log(e);continue}$("#add-cert-dialog").modal("show")},contentType:"application/json"})}),$(document).on("click",".more-store-resume",function(){var e=$(this).closest(".cert-container").find(".more-store-resume-div");"none"==e.css("display")?e.css("display","block"):e.css("display","none")}),$(".option-open").eq(0).click(function(){var e=$(".sub-info-select-div");"none"==e.css("display")?e.css("display","block"):e.css("display","none"),loadcertlist()}),$(".option-open").eq(1).click(function(){element=$(".sub-info img:nth-child(2)"),0<=element.attr("src").indexOf("path-2")?(sortingOrder="asc",element.attr("src",element.attr("src").replace("path-2","path-1"))):0<=element.attr("src").indexOf("path-1")&&(sortingOrder="desc",element.attr("src",element.attr("src").replace("path-1","path-2"))),loadcertlist()}),$(".sub-info-select-p").click(function(){$(".sub-info-select-p").removeClass("active"),$(this).addClass("active"),$(".sub-info-select-div").css("display","none"),$("p.option-open").text($(this).text()),"최신 발급일 순"==$(this).text()?sortingField="date":"발급 기관 순"==$(this).text()&&(sortingField="subId"),loadcertlist()}),$("#add-cert-dialog .confirm-btn").click(function(){$("#add-cert-dialog  .close-modal").click();var e=0;$("#cert-line-dialog #circle-"+e).css("background-color","#4a90e2");var t=setInterval(function(){$("#cert-line-dialog #circle-"+e).css("background-color","#dadada"),5<(e+=1)&&(e=0,clearInterval(t)),$("#cert-line-dialog #circle-"+e).css("background-color","#4a90e2")},1e3);setTimeout(function(){$("#cert-line-dialog  .close-modal").click(),$("#alarm-div span").text('증명서 발급이 완료되었습니다.  "증명서보관함"에서 확인해주세요.'),$("#alarm-div").css("display","block"),setTimeout(function(){$("#alarm-div").hide()},2e3)},3e3),$('input:checkbox[name="certcheck"]').each(function(){if(this.checked){var e=this.id,t=sessionStorage.getItem(e),r={};r.txid=e,r.record=JSON.parse(t),console.log("cert req param"),console.log(r),$.ajax({type:"POST",url:"/certs",headers:{Authorization:client_authorization},data:JSON.stringify({cert:r}),error:function(e,t,r){console.error("Cert check error : "+r),console.error(e.responseText)},success:function(e){console.log(e),loadcertlist()},contentType:"application/json"})}})})});