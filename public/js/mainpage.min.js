function change_default_cert(e){$(".change_cert").remove();var o=getTxidList();for(var r in o)try{var t=getData(o[r]),a=(t.dftYn,t.subid);e==a&&record_change_formatter[a](t)}catch(e){continue}$("#spec-change-dialog").modal("show")}function delete_private_record(e,t){$.ajax({type:"DELETE",url:"/records/"+e,headers:{Authorization:client_authorization},beforeSend:function(){},error:function(e,o,r){console.error("Delete private record Error : "+r),console.error(e.responseText),t(e.responseJSON)},success:function(e){$("#alarm-div span").text("정상적으로 삭제 완료되었습니다."),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-108px"),setTimeout(function(){$("#alarm-div").hide()},1e3),t(null,e)}})}function singletonCallback(e,o,r,t){}function buttonCallback(e,o,r,t){}function getPrivateRecords(){$.ajax({type:"GET",url:"/records/list",headers:{Authorization:client_authorization},beforeSend:function(){$(".private-spec-body").remove()},error:function(e,o,r){console.error("Get private record Error : "+r),console.error(e.responseText)},success:function(e){e.result.forEach(function(e,o){var r=JSON.parse(e.data);r.certPrvtId=e.certPrvtId,e.subCd in formatter&&formatter[e.subCd](r)}),$(".private-spec-body").on("click",singletonCallback),$(".private-spec-body button").on("click",buttonCallback),(0<$("#spec_edu_detail .spec-body").length||0<$("#spec_edu_detail .private-spec-body").length)&&$("#spec_edu_detail > .spec-body-default").hide(),(0<$("#spec_forign_lang .spec-body").length||0<$("#spec_forign_lang .private-spec-body").length)&&$("#spec_forign_lang > .spec-body-default").hide(),(0<$("#spec_certification .spec-body").length||0<$("#spec_certification .private-spec-body").length)&&$("#spec_certification > .spec-body-default").hide()}})}function request_agent(){setTxidList([]),getRSAKey();var e=KEYUTIL.getJWKFromKey(rsakey_pub);$.ajax({type:"POST",url:"/client",headers:{Authorization:client_authorization},data:JSON.stringify({cmd:"SearchRecord",args:{pkey:"asdfasdf",update:!1,n:e.n,e:e.e}}),beforeSend:function(){$(".spec-body").remove()},success:function(e){setSocket(e.mid),clientsocket_listener(),setTimeout(function(){$(".spec-body-loading").hide(),$(".spec-body-default").show(),refreshview(null)},1500)},contentType:"application/json"})}function refreshview(e){$(".spec-body-loading").hide();var o={},r="";if(null!=e)for(var t in e)try{var a=(i=e[t]).subid;if("Y"==i.dftYn)(c=i.data).chkid=i.txid,null==o[c.subid=a]?c.count=1:c.count=o[a].count+1,o[a]=c,r=a;else if(r!=a){(c=i.data).chkid=i.txid,null==o[c.subid=a]?c.count=1:c.count=o[a].count+1,o[a]=c,r=a}else null==o[a]?c.count=1:c.count=o[a].count+1}catch(e){continue}else{$(".spec-body").remove();var s=getTxidList();for(var t in s)try{var i;a=(i=getData(s[t])).subid;if("Y"==i.dftYn)(c=i.data).chkid=i.txid,null==o[c.subid=a]?c.count=1:c.count=o[a].count+1,o[a]=c,r=a;else if(r!=a){var c;(c=i.data).chkid=i.txid,null==o[c.subid=a]?c.count=1:c.count=o[a].count+1,o[a]=c,r=a}else null==o[a]?c.count=1:c.count=o[a].count+1}catch(e){console.error(JSON.stringify(e));continue}}for(var t in o){r=o[t].subid;formatter[r](o[t])}(0<$("#spec_edu_detail .spec-body").length||0<$("#spec_edu_detail .private-spec-body").length)&&$("#spec_edu_detail > .spec-body-default").hide(),(0<$("#spec_forign_lang .spec-body").length||0<$("#spec_forign_lang .private-spec-body").length)&&$("#spec_forign_lang > .spec-body-default").hide(),(0<$("#spec_certification .spec-body").length||0<$("#spec_certification .private-spec-body").length)&&$("#spec_certification > .spec-body-default").hide()}function clientsocket_listener(){socket.on("SearchResult",function(e){console.log("=============clientsocket_listener================="),console.log(e),console.log("===================================================");for(var o=JSON.parse(e),r=o.key,t=o.iv,a=base64toHEX(r),s=KJUR.crypto.Cipher.decrypt(a,rsakey_prv),i=(o.orgcode,0);i<o.records.length;i++){o.records[i].subid;var c=CryptoJS.AES.decrypt(o.records[i].data,CryptoJS.enc.Base64.parse(s),{iv:CryptoJS.enc.Base64.parse(t)});console.log(c.toString(CryptoJS.enc.Utf8)),o.records[i].data=c.toString(CryptoJS.enc.Utf8);try{setData(o.records[i])}catch(e){console.log(e)}}refreshview(o.records)})}function firstLogin(){$(".section-1 button").click(function(){$(".section-1").css("display","none"),$(".section-3").css("display","block"),setTimeout(function(){$(".ko-progress-circle").attr("data-progress",20),$(".percentage span").text("20%")},100),setTimeout(function(){$(".ko-progress-circle").attr("data-progress",50),$(".percentage span").text("50%")},1e3),setTimeout(function(){$(".ko-progress-circle").attr("data-progress",100),$(".percentage span").text("100%"),setTimeout(function(){$(".percentage span").css("display","none"),$(".section-3 button").prop("disabled",!1),$(".percentage img").css("display","block")},1e3)},2e3)}),$(".section-3 button").click(function(){$("#initial-dialog .close-modal").click()}),$("#initial-dialog").modal("show")}function setSocket(e){socket.close(),socket=io(),socket.emit("SetSocket",{mid:e})}function getTargetdivid(e){if("RCCNF0001"==e);else if("RCLPT0005"==e)return"spec_forign_lang"}$(document).ready(function(){$(".study-period").datepicker(),$(".study-period").datepicker("option","dateFormat","yy-mm-dd"),client_token=getCookie("JWT"),client_authorization="Bearer "+client_token,$(".spec-body-loading").show(),$(".spec-body-default").hide(),$("#header-mycert").click(function(){$("#header-myresume").css({border:"none","font-weight":"normal"}),$("#header-resume-store").css({border:"none","font-weight":"normal"}),$(this).css({"border-bottom":"solid 5px #4c80f1","font-weight":"bold"}),window.location="certs"}),$("#header-resume-store").click(function(){$("#header-myresume").css({border:"none","font-weight":"normal"}),$("#header-mycert").css({border:"none","font-weight":"normal"}),$(this).css({"border-bottom":"solid 5px #4c80f1","font-weight":"bold"}),window.location="resumes"}),$("#header-myresume").click(function(){$("#header-mycert").css({border:"none","font-weight":"normal"}),$("#header-resume-store").css({border:"none","font-weight":"normal"}),$(this).css({"border-bottom":"solid 5px #4c80f1","font-weight":"bold"}),window.location="main"}),$("#education-add-dialog .add-span").click(function(){console.log("#education-add-dialog .add-span clicked"),$("#major-div").append('<div class="error-range major-div"><div class="select-100"><select name="select-1"><option value="1">전공</option><option value="2">부전공</option><option value="3">복수전공</option></select></div><div class="select-100"><select name="select-2"><option value="volvo">학사</option><option value="saab">석사</option></select></div><input type="text" class="major add-major" placeholder="전공을 입력해주세요. Ex) 컴퓨터 공학"><img src="/img/myresume/close-white.svg"/><div class="error-message">전공을 입력해주세요.</div></div>'),$("select").selectize()}),$("#education-add-dialog .confirm-btn").click(function(){var r=!1;""==$("#school").val()?($("#school").addClass("error"),$("#school").next().css("display","block"),r=!0):($("#school").removeClass("error"),$("#school").next().css("display","none")),$(".major").each(function(){var e=$(this),o=e.closest(".error-range");if(""==e.val())e.addClass("error"),o.find(".items ").addClass("error"),o.find(".error-message").css("display","block"),r=!0;else{o=e.closest(".error-range");e.removeClass("error"),o.find(".items ").removeClass("error"),o.find(".error-message").css("display","none")}});var e=$("#education-add-dialog .study-period"),o=e.closest(".error-range");""==e[0].value||""==e[1].value?(e.addClass("error"),o.find("button").addClass("error"),o.find(".items").addClass("error"),o.find(".error-message").css("display","block"),r=!0):(e.removeClass("error"),o.find("button").removeClass("error"),o.find(".items").removeClass("error"),o.find(".error-message").css("display","none"));o=$("#score").closest(".error-range");""==$("#score").val()?($("#score").addClass("error"),o.find(".items").addClass("error"),o.find(".error-message").css("display","block"),r=!0):($("#score").removeClass("error"),o.find(".items").removeClass("error"),o.find(".error-message").css("display","none"));var t={school_name:$("#school").val(),degree:$("#score").val()+"/"+$("#total_score").val(),startdate:$("#edu-startdate").val(),enddate:$("#edu-enddate").val(),status:$("#study-field").val()},a=JSON.stringify(t);r||$.ajax({type:"POST",url:"/records",headers:{Authorization:client_authorization},data:JSON.stringify({orgCd:"UNV",subCd:"UNV",data:a}),error:function(e,o,r){console.error("/record Error : "+r),console.error(e.responseText)},success:function(e){$("#education-add-dialog .close-modal").click(),$("#alarm-div span").text("정상적으로 입력 완료되었습니다."),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-108px"),setTimeout(function(){$("#alarm-div").hide()},3e3),$(".private-spec-body").remove(),$("#spec_edu_detail > .spec-body-default").hide(),getPrivateRecords()},contentType:"application/json"})}),$("#career-add-dialog .confirm-btn").click(function(){var e={company:$("#career-company").val(),position:$("#career-position").val(),role:$("#career-role").val(),startdate:$("#career-startdate").val(),enddate:$("#career-enddate").val(),status:$("#career-status").val()},o=JSON.stringify(e);$.ajax({type:"POST",url:"/records",headers:{Authorization:client_authorization},data:JSON.stringify({orgCd:"ETC",subCd:"CPR",data:o}),error:function(e,o,r){console.error("/record Error : "+r),console.error(e.responseText)},success:function(e){$("#career-add-dialog .close-modal").click(),$("#alarm-div span").text("사용자 이력 수기 입력했다."),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-108px"),$(".private-spec-body").remove(),getPrivateRecords()},contentType:"application/json"})}),$("#language-add-dialog .confirm-btn").click(function(){var e=$("#language-issuer").val(),o=$("#langadd_lang").val(),r=$("#language-name").val(),t=$("#language-grade").val(),a=$("#langadd_startdate").val(),s=$("#langadd_enddate").val(),i=$("#langadd_expireYn").is(":checked"),c=!1;$("#langadd_lang").val("E"),$("#language-add-dialog input[type=text]").not("#langadd_lang-selectized").each(function(){""==$(this).val()?(c=!0,$(this).hasClass("study-period")?($(this).addClass("error"),$("#language-add-dialog .error-message-period").show()):($(this).addClass("error"),$(this).next().show())):$(this).hasClass("study-period")?($(this).removeClass("error"),$("#language-add-dialog .error-message-period").hide()):($(this).removeClass("error"),$(this).next().hide())});var n={issuer:e,lang:o,name:r,score:t,startdate:a,enddate:s,expiry:i},d=JSON.stringify(n);c||$.ajax({type:"POST",url:"/records",headers:{Authorization:client_authorization},data:JSON.stringify({orgCd:"EDI",subCd:"LPT",data:d}),error:function(e,o,r){console.error("/record Error : "+r),console.error(e.responseText)},success:function(e){$("#language-add-dialog .close-modal").click(),$("#alarm-div span").text("정상적으로 입력 완료되었습니다."),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-108px"),setTimeout(function(){$("#alarm-div").hide()},3e3),$(".private-spec-body").remove(),$("#spec_forign_lang > .spec-body-default").hide(),getPrivateRecords()},contentType:"application/json"})}),$("#cert-add-dialog .confirm-btn").click(function(){var e=$("#cert-issuer").val(),o=$("#cert-name").val(),r=$("#cert-grade").val(),t=$("#certadd_startdate").val(),a=$("#certadd_enddate").val(),s=$("#certadd_expireYn").is(":checked"),i=!1;$("#cert-add-dialog input[type=text]").each(function(){""==$(this).val()?(i=!0,$(this).hasClass("study-period")?($(this).addClass("error"),$("#cert-add-dialog .error-message-period").show()):($(this).addClass("error"),$(this).next().show())):$(this).hasClass("study-period")?($(this).removeClass("error"),$("#cert-add-dialog .error-message-period").hide()):($(this).removeClass("error"),$(this).next().hide())});var c={issuer:e,name:o,grade:r,startdate:t,enddate:a,expiry:s},n=JSON.stringify(c);i||$.ajax({type:"POST",url:"/records",headers:{Authorization:client_authorization},data:JSON.stringify({orgCd:"STI",subCd:"OGC",data:n}),error:function(e,o,r){console.error("/record Error : "+r),console.error(e.responseText)},success:function(e){$("#cert-add-dialog .close-modal").click(),$("#alarm-div span").text("정상적으로 입력 완료되었습니다."),$("#alarm-div").css("display","block"),setTimeout(function(){$("#alarm-div").hide()},3e3),$(".private-spec-body").remove(),$("#spec_certification > .spec-body-default").hide(),getPrivateRecords()},contentType:"application/json"})}),$("#spec-change-dialog .confirm-btn").click(function(){$(".abc-radio input:radio").each(function(){if($(this).is(":checked")){var s=$(this).attr("id").substring(12),i=$(this).parent().attr("id").substring(12);$.ajax({type:"POST",url:"/certs/setDefault",headers:{Authorization:client_authorization},data:JSON.stringify({txid:s,subid:i}),error:function(e,o,r){console.error("Set default Error : "+r),console.error(e.responseText)},success:function(e){$("#spec-change-dialog .close-modal").click(),$("#alarm-div span").text("정상적으로 이력이 변경되었습니다."),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-142px");var o=getTxidList();for(var r in o)try{var t=getData(o[r]),a=(t.dftYn,t.subid);t.data;i==a&&(s==t.txid?t.dftYn="Y":t.dftYn="N",t.data=JSON.stringify(t.data),setData(t))}catch(e){console.error(e);continue}refreshview()},error:function(e,o,r){console.error("Set Default Error : "+r),console.error(e.responseText)},contentType:"application/json"})}})}),$(".spec-detail-div").click(function(e){$(".spec-detail-div input:checkbox").each(function(e){$(this).is(":checked")?$(this).closest(".spec-body").css({border:"solid 1px #4c80f1","border-radius":"4px","background-color":"rgba(76, 128, 241, 0.05)"}):$(this).closest(".spec-body").css({border:"none","border-bottom":"solid 1px #dfe5ef","background-color":"white"});var o=$(".spec-detail-div input:checkbox:checked").length;0==o?($("#select-footer").hide(),$("#main-footer").css("margin-bottom","0px")):($("#main-footer").css("margin-bottom","71px"),$("#select-footer span:nth-child(2)").text(o+"건의"),$("#select-footer").show())})}),$("#cert-issue-button").click(function(){var a=!1;$(".spec-detail-div input:checkbox").each(function(e){if($(this).is(":checked")){var o=$(this).attr("id"),r=sessionStorage.getItem(o),t={};t.txid=o,t.record=JSON.parse(r),$.ajax({type:"POST",url:"/certs",headers:{Authorization:client_authorization},data:JSON.stringify({cert:t}),beforeSend:function(){if(!a){a=!0;var e=0;$("#cert-line-dialog #circle-"+e).css("background-color","#4a90e2");var o=setInterval(function(){$("#cert-line-dialog #circle-"+e).css("background-color","#dadada"),5<(e+=1)&&(e=0),$("#cert-line-dialog #circle-"+e).css("background-color","#4a90e2")},1e3);setTimeout(function(){$("#cert-line-dialog .close-modal").click(),$("#alarm-div").css("display","block"),$("#alarm-div").css("margin-right","-224px"),$("#select-footer").hide(),$("#alarm-div span").text("증명서 발급이 완료되었습니다. 증명서보관함에서 확인해주세요."),$(".spec-detail-div input:checkbox").attr("checked",!1),$(".spec-body").css({border:"none","border-bottom":"solid 1px #dfe5ef","background-color":"white"}),clearInterval(o),setTimeout(function(){$("#alarm-div").hide(),a=!1,window.location.href="./certs"},1e3)},3e3)}},success:function(e){},error:function(e,o,r){console.error("/Issue cert error : "+r),console.error(e.responseText)},contentType:"application/json"})}})}),$("#refresh_record").click(function(){$(".spec-body-loading").show(),$(".spec-body-default").hide(),getRSAKey();var e=KEYUTIL.getJWKFromKey(rsakey_pub);setTxidList([]),$.ajax({type:"POST",url:"/client",headers:{Authorization:client_authorization},beforeSend:function(){$(".spec-body").remove(),$(".spec-body-default").css("display","none"),$(".spec-body-loading").css("display","block")},data:JSON.stringify({cmd:"SearchRecord",args:{pkey:"asdfasdf",update:!0,n:e.n,e:e.e}}),error:function(e,o,r){console.error("Search record Error : "+r),console.error(e.responseText)},success:function(e){setSocket(e.mid),clientsocket_listener(),setTimeout(function(){$(".spec-body-loading").hide(),$(".spec-body-default").show()},1500)},contentType:"application/json"})}),document.getElementById("spec_forign_lang_targetdiv").addEventListener("private_deleted",function(e){e.stopPropagation(),e.preventDefault(),0==$("#spec_forign_lang .private-spec-body").length&&$(e.currentTarget).show()},!0)}),window.onload=function(){socket=io();var e=getTxidList();if(1<e.length){for(var o=[],r=0;r<e.length;r++)try{var t=getData(e[r]);o.push(t)}catch(e){console.error(e);continue}$(".spec-body-default").show(),refreshview(o),$("#initial-dialog .close-modal").click()}else genRsaKey(function(e,o){e?console.error(JSON.stringify(e)):o&&request_agent()});getPrivateRecords()};