{"version":3,"sources":["../../../../src/modules/token/token.js"],"names":["TokenManager","opt","info","sign","data","exp","Math","floor","Date","now","req","res","next","bearerToken","bearerHeader","headers","bearer","split","verify","error","decoded","console","log","send","token","body","args","userid","ignoredCmd","ignoredFlag","forEach","ingored","cmd","decode","complete"],"mappings":"gnBAAA,4C;;AAEA,uD;;;AAGA;;;;;AAKMA,Y;AACF,0BAAYC,GAAZ,EAAiB;AACPA,WADO;AAEhB,K;;AAEaC,Y,EAAM;AAChB,mBAAO,uBAAIC,IAAJ,CAAS;AACZC,sBAAMF,IADM;AAEZG,qBAAKC,KAAKC,KAAL,CAAWC,KAAKC,GAAL,KAAa,IAAxB,IAAiC,KAAK,EAAL,GAAU,CAFpC,CAEuC;AACnD;AAHY,aAAT,EAIJ,kBAJI,CAAP;AAKH,S;;AAEWC,W,EAAKC,G,EAAKC,I,EAAM;AACxB,gBAAIC,WAAJ;AACA,gBAAIC,eAAeJ,IAAIK,OAAJ,CAAY,eAAZ,CAAnB;AACA,gBAAI,OAAOD,YAAP,KAAwB,WAA5B,EAAyC;AACrC,oBAAIE,SAASF,aAAaG,KAAb,CAAmB,GAAnB,CAAb;AACAJ,8BAAcG,OAAO,CAAP,CAAd;;AAEA,uCAAIE,MAAJ,CAAWL,WAAX,EAAwB,kBAAxB,EAA4C,UAAUM,KAAV,EAAiBC,OAAjB,EAA0B;AAClE,wBAAID,KAAJ,EAAW;AACPE,gCAAQC,GAAR,CAAYH,KAAZ;AACAR,4BAAIY,IAAJ,CAAS,GAAT;AACH,qBAHD,MAGO;AACHF,gCAAQC,GAAR,CAAYF,OAAZ;AACAV,4BAAIc,KAAJ,GAAYX,WAAZ;AACAH,4BAAIe,IAAJ,CAASC,IAAT,CAAcC,MAAd,GAAuBP,QAAQhB,IAAR,CAAauB,MAApC;AACAf;AACH;AACJ,iBAVD;AAWH,aAfD,MAeO;AACH,oBAAIgB,aAAa,CAAC,QAAD,EAAU,OAAV,CAAjB,CADG,CACkC;AACrC,oBAAIC,cAAc,KAAlB;;AAEAD,2BAAWE,OAAX,CAAmB,UAAUC,OAAV,EAAmB;AAClC,wBAAIA,WAAWrB,IAAIe,IAAJ,CAASO,GAAxB,EAA6B;AACzBH,sCAAc,IAAd;AACH;AACJ,iBAJD;;AAMA,oBAAIA,WAAJ,EAAiB;AACbjB;AACH,iBAFD,MAEO;AACHD,wBAAIY,IAAJ,CAAS,GAAT;AACH;AACJ;AACJ,S;;AAEYC,a,EAAO;AAChB,mBAAO,uBAAIS,MAAJ,CAAWT,KAAX,EAAkB,EAAEU,UAAU,IAAZ,EAAlB,CAAP;AACH,S;;;AAGUlC,Y","file":"token.js","sourcesContent":["import jwt from 'jsonwebtoken'\r\n\r\nimport AbstractManager from \"../abstract_manager\";\r\n\r\n\r\n/**\r\n * TokenManager. <br />\r\n * \r\n * @since 180305\r\n */\r\nclass TokenManager extends AbstractManager {\r\n    constructor(opt) {\r\n        super(opt);\r\n    }\r\n\r\n    generateToken(info) {\r\n        return jwt.sign({\r\n            data: info,\r\n            exp: Math.floor(Date.now() / 1000) + (60 * 60 * 1) // 1hour\r\n            //}, 'rezoomesecretkey', { expiresIn: '1' });\r\n        }, 'rezoomesecretkey');\r\n    }\r\n\r\n    filterToken(req, res, next) {\r\n        var bearerToken;\r\n        var bearerHeader = req.headers[\"authorization\"];\r\n        if (typeof bearerHeader !== 'undefined') {\r\n            var bearer = bearerHeader.split(\" \");\r\n            bearerToken = bearer[1];\r\n\r\n            jwt.verify(bearerToken, 'rezoomesecretkey', function (error, decoded) {\r\n                if (error) {\r\n                    console.log(error);\r\n                    res.send(403);\r\n                } else {\r\n                    console.log(decoded);\r\n                    req.token = bearerToken;\r\n                    req.body.args.userid = decoded.data.userid;\r\n                    next();\r\n                }\r\n            });\r\n        } else {\r\n            var ignoredCmd = ['Health','Login']; // ignore cmd\r\n            var ignoredFlag = false;\r\n\r\n            ignoredCmd.forEach(function (ingored) {\r\n                if (ingored == req.body.cmd) {                    \r\n                    ignoredFlag = true;                    \r\n                }\r\n            });\r\n\r\n            if (ignoredFlag) {                \r\n                next();\r\n            } else {\r\n                res.send(403);\r\n            }\r\n        }        \r\n    }\r\n\r\n    decodedToken(token) {\r\n        return jwt.decode(token, { complete: true });\r\n    }\r\n}\r\n\r\nexport default TokenManager;"]}