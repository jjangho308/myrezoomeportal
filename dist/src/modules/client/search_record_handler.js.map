{"version":3,"sources":["../../../../src/modules/client/search_record_handler.js"],"names":["SearchRecordRequestHandler","opt","clientReq","done","rezoome_id","userid","orgs","db","getUserDao","get","err","users","msg","cmd","mid","args","push","sendMessage","RESULT_FAILURE","RESULT_PENDING","clientRequest","agentRequest","socket"],"mappings":"gnBAAA,+C;;AAEA,8B;AACA,oC;;AAEA,kF;;AAEA,kD;AACA,gD;;AAEA;;;;;;;AAOMA,0B;AACF,wCAAYC,GAAZ,EAAiB;AACPA,WADO;AAEhB;;AAED;;;;;;;;;;;;;;;AAeQC,iB,EAAWC,I,EAAM;AACrB;;AAEA;AACA,gBAAIC,aAAaF,UAAUG,MAA3B;AACA,gBAAIC,OAAOJ,UAAUI,IAArB;;AAEA;AACA;AACA,gBAAIC,KAAK,mBAASA,EAAT,EAAT;;AAEA;AACAA,eAAGC,UAAH,GAAgBC,GAAhB,CAAoBL,UAApB,EAAgC,UAACM,GAAD,EAAMC,KAAN,EAAgB;;AAE5C,oBAAIC,MAAM,qBAAqB;AAC3BC,yBAAKX,UAAUW,GADY;AAE3BC,yBAAKZ,UAAUY,GAFY;AAG3BC,0BAAOJ,KAHoB,EAArB,CAAV;;;AAMA,mCAASK,IAAT,GAAgBC,WAAhB,CAA4BL,GAA5B,EAAiCN,IAAjC,EAAuC,eAAO;AAC1C,qBAAC,CAACI,GAAF,GAAQP,KAAK,yBAAqBe,cAA1B,EAA0CR,GAA1C,CAAR,GAAyDP,KAAK,yBAAqBgB,cAA1B,CAAzD;AACH,iBAFD;AAGH,aAXD;AAYH,S;;AAEQC,qB,EAAeC,Y,EAAc;AAClC,gBAAIC,SAASF,cAAcE,MAA3B;;AAEA;AACH;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGWtB,0B","file":"search_record_handler.js","sourcesContent":["import Managers from '../../core/managers'\r\n\r\nimport DataManager from '../db/db';\r\nimport PushManager from '../push/push';\r\n\r\nimport AbstractClientRequestHandler from './abstract_clientrequest_handler';\r\n\r\nimport ClientRequestManager from './client_request'\r\nimport SearchRecordPush from '../push/message/search';\r\n\r\n/**\r\n * Handler for SearchRecordRequest. <br />\r\n * 이력 검색 요청 핸들러.\r\n * \r\n * @author CHANGHO\r\n * @since 180313\r\n */\r\nclass SearchRecordRequestHandler extends AbstractClientRequestHandler {\r\n    constructor(opt) {\r\n        super(opt);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {HttpResponse} httpRes \r\n     * @param {SearchRecordRequest} clientReq {\r\n     *      userId : \"rezoome Id\",\r\n     *      orgs    : [{\r\n     *                      code : '기관 코드',\r\n     *                      key : {\r\n     *                                  var1 : '키1',\r\n     * *                                var2 : '키2',\r\n     *                              }\r\n     *                  }\r\n     *              ]\r\n     * }\r\n     */\r\n    request(clientReq, done) {\r\n        // 1. 기관 정보를 db에서 가져오고\r\n\r\n        //orgcode => sendmessage \r\n        var rezoome_id = clientReq.userid;\r\n        var orgs = clientReq.orgs;\r\n\r\n        //get personal info(rezoome id => username, birth, gender, phone, ci, email)\r\n        ///////////////////////////////////////////////////////////////////\r\n        var db = Managers.db();\r\n\r\n        //send message\r\n        db.getUserDao().get(rezoome_id, (err, users) => {\r\n\r\n            var msg = new SearchRecordPush({\r\n                cmd: clientReq.cmd,\r\n                mid: clientReq.mid,\r\n                args : users\r\n            });\r\n\r\n            Managers.push().sendMessage(msg, orgs, err => {\r\n                !!err ? done(ClientRequestManager.RESULT_FAILURE, err) : done(ClientRequestManager.RESULT_PENDING);\r\n            });\r\n        })\r\n    }\r\n\r\n    response(clientRequest, agentRequest) {\r\n        var socket = clientRequest.socket;\r\n        \r\n        // TODO socket으로 발신\r\n    }\r\n\r\n    // makeMSG(clientReq, personalInfo) {\r\n\r\n    //     var args = {};\r\n    //     args.username = personalInfo[0].NAME;\r\n    //     args.birth = personalInfo[0].BIRTH;\r\n    //     args.gender = personalInfo[0].GENDER;\r\n    //     args.phone = personalInfo[0].PHONE;\r\n    //     args.ci = personalInfo[0].CI;\r\n    //     args.email = personalInfo[0].EMAIL;\r\n\r\n    //     var msg = new SearchRecordPush({\r\n    //         cmd: clientReq.cms,\r\n    //         mid: clientReq.mid,\r\n    //         args = args\r\n    //     });\r\n    //     return msg;\r\n    // }\r\n}\r\n\r\nexport default SearchRecordRequestHandler;"]}